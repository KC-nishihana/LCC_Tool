# Blender用 LCCツール

LCCツールは、LCC（Lightweight Compressed Cloud）スプラットデータをインポートしてレンダリングするために設計されたBlenderアドオンです。`.lcc`ファイルを読み込み、ジオメトリノードを使用して可視化し、Cyclesエンジンを使用して高品質な360度パノラマレンダリングをセットアップすることができます。

## 機能

*   **LCCインポート**: `.lcc`ファイルとそれに関連する `Index.bin` および `Data.bin` データを読み込みます。
*   **マルチLODサポート**: 指定した範囲（Min/Max）のLODデータをまとめて読み込み、統合して扱います。
*   **距離ベースのLOD制御**: カメラからの距離に応じて、遠くの点を間引くLODロジックをジオメトリノードで自動構築します。
*   **ビューポート最適化**: 編集時のパフォーマンスを確保するため、3Dビューポート上では点群の約10%のみをランダムに表示します（レンダリング時は100%表示されます）。
*   **ジオメトリノードレンダリング**: スプラットを3D形状（Cubeベース）としてレンダリングするためのモディファイアをセットアップします。
*   **カスタムシェーダー**: ガウス減衰（Gaussian falloff）を持つ `GaussianSplatMat` マテリアルを生成し、正確なスプラット表現を行います。
*   **360度レンダリングセットアップ**: パノラマカメラを自動構成し、Cyclesの透過設定を最適化します。

## 必須要件

*   **Blender**: バージョン 3.3 以上（ジオメトリノードの互換性のため推奨）。
*   **Python ライブラリ**: `numpy`（Blenderに標準搭載されています）。

## インストール方法

1.  `LCC_Render.py` をダウンロードします。
2.  Blenderを開きます。
3.  **編集 (Edit) > プリファレンス (Preferences) > アドオン (Add-ons)** に移動します。
4.  **インストール... (Install...)** をクリックし、`LCC_Render.py` を選択します。
5.  **Import-Export: LCC Tools** のチェックボックスをオンにして、アドオンを有効にします。

## 使用方法

1.  3Dビューポートで `N` キーを押してサイドバーを開きます。
2.  **LCC Tools** タブをクリックします。
3.  **Import LCC (.lcc)** ボタンをクリックします。
4.  対象の `.lcc` ファイルを選択します。
5.  インポート設定を調整します：
    *   **Min LOD / Max LOD**: 読み込むLODレベルの範囲を指定します。
    *   **Scale Multiplier**: スプラットのサイズ倍率（デフォルト: 1.5）。
    *   **Min Thickness**: スプラットの最小厚み。
    *   **LOD Distance**: 距離による表示密度減衰の強さを調整します。
    *   **Setup 360 Render**: レンダリング設定の自動セットアップを行います。
6.  **Import LCC** をクリックして完了します。

## インポート設定の詳細

*   **Min LOD / Max LOD**:
    *   インポートするLODレベルの開始と終了を指定します。範囲内の全てのLODデータが読み込まれ、一つのメッシュに統合されます。
*   **Scale Multiplier**:
    *   全てのスプラットのスケールを乗算します。値を大きくすると隙間が埋まりますが、形状が肥大化して見える場合があります。
*   **Min Thickness**:
    *   スプラットの最小軸に対して最小スケールを強制します。薄いスプラットが角度によって消えてしまうのを防ぎます。
*   **LOD Distance**:
    *   カメラからの距離に応じた点の間引き（カリング）計算に使用される係数です。
    *   値が大きいほど、遠くの点が表示されやすくなります。値が小さいと、カメラから離れた点がより早く非表示になります。
*   **Setup 360 Render**:
    *   レンダリングエンジンを **Cycles** に切り替えます。
    *   (0,0,0) の位置に **PanoramaCam** を作成します。
    *   解像度を 4096x2048 に設定します。
    *   **透過バウンス数**：Max Bouncesを32、Transparent Max Bouncesを64に設定し、多数の半透明スプラットが重なるシーンでの黒ずみを防ぎます。

## 技術的詳細

*   **データ構造**: `Index.bin` と `Data.bin` から位置、色、スケール、回転、LODレベルを読み込みます。
*   **回転**: パックされた uint32 形式からクォータニオンへ、さらにオイラー角へと変換されます。
*   **ビューポート表示**: `GeometryNodeIsViewport` ノードを使用し、プレビュー時はランダムに点を間引くことで操作性を向上させています。
*   **レンダリング**: ポイント上にCubeをインスタンス化し、シェーダーでガウス分布のアルファマスクを適用することで、滑らかなスプラットとして描画します。
